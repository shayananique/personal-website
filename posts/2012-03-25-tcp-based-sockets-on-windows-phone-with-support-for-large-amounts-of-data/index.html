<!doctype html><html lang=en><head><title>TCP-based sockets on Windows Phone with support for large amounts of data :: Shayan Anique</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Network communication through sockets is a welcome addition to the Windows Phone platform. Personally, I enjoy using those because of the tremendous performance gain compared to WCF services. One topic, however, seems to be rarely covered when it comes to TCP-based communication between the server (presumably running on a desktop machine) and the client (Windows Phone) = transmission of large amounts of data.
A lot of existing samples assume that the communication, although bi-directional, is done with small data units."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://shayananique.com/posts/2012-03-25-tcp-based-sockets-on-windows-phone-with-support-for-large-amounts-of-data/><link rel=stylesheet href=https://shayananique.com/assets/style.css><link rel=stylesheet href=https://shayananique.com/assets/blue.css><link rel=apple-touch-icon href=https://shayananique.com/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://shayananique.com/img/favicon/blue.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="TCP-based sockets on Windows Phone with support for large amounts of data"><meta property="og:description" content="Network communication through sockets is a welcome addition to the Windows Phone platform. Personally, I enjoy using those because of the tremendous performance gain compared to WCF services. One topic, however, seems to be rarely covered when it comes to TCP-based communication between the server (presumably running on a desktop machine) and the client (Windows Phone) = transmission of large amounts of data.
A lot of existing samples assume that the communication, although bi-directional, is done with small data units."><meta property="og:url" content="https://shayananique.com/posts/2012-03-25-tcp-based-sockets-on-windows-phone-with-support-for-large-amounts-of-data/"><meta property="og:site_name" content="Shayan Anique"><meta property="og:image" content="https://shayananique.com/img/favicon/blue.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Programming"><meta property="article:section" content="Windows Phone"><meta property="article:published_time" content="2012-03-25 21:49:00 +0000 UTC"></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Shayan Anique</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/showcase>Showcase</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/showcase>Showcase</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://shayananique.com/posts/2012-03-25-tcp-based-sockets-on-windows-phone-with-support-for-large-amounts-of-data/>TCP-based sockets on Windows Phone with support for large amounts of data</a></h1><div class=post-meta><span class=post-date>2012-03-25</span></div><div class=post-content><div><p>Network communication through sockets is a welcome addition to the Windows Phone platform. Personally, I enjoy using those because of the tremendous performance gain compared to WCF services. One topic, however, seems to be rarely covered when it comes to TCP-based communication between the server (presumably running on a desktop machine) and the client (Windows Phone) = transmission of large amounts of data.</p><p>A lot of existing samples assume that the communication, although bi-directional, is done with small data units. For example, <a href=http://msdn.microsoft.com/en-us/library/5w7b7x5f.aspx>here is a pretty good sample</a> that I used to build the asynchronous server. The reading callback looks like this:</p><p>It works perfectly fine on the desktop machine. I am also adding a terminator verification statement that allows me to check whether the whole data set was received:</p><p>Although seemingly simple, the data receiving process on a Windows Phone is handled in a different manner. There is no direct implementation of<a href=http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.beginreceive.aspx>Socket.BeginReceive</a>. Instead, developers work with <a href="http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.receiveasync(v=vs.95).aspx">Socket.ReceiveAsync</a>. Many samples give you this piece of code:</p><p>Notice the problem with this snippet. Once the string is received, that will be it. The inbound data length will be limited to the size of the buffer, and the maximum chunk size. The buffer size cannot always be fixed, and it is safe to assume that the developer does not want to allocate too much space for that in one iteration. The default socket chuck size cannot always be accommodated either.</p><p>The resolution comes in a continuous invocation of <a href="http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.receiveasync(v=vs.95).aspx">Socket.ReceiveAsync</a>:</p><p>Here is where the terminator character plays a major role. Look at** <em>if (dataFromServer.EndsWith(terminator)) –</em>** that is the flag that shows whether more data is coming or not. With a receiving structure like I showed above, it is possible to keep receiving data until the connection is closed (happens all the time) or the terminator character is detected.</p><blockquote><p><strong>NOTE:</strong> If you are wondering what terminator character to use, try going with non-standard ones. For example, <em><strong>\u00BE</strong>.</em> Otherwise, chances are that the actual “terminator” is not the terminating character.</p></blockquote></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://shayananique.com/posts/2012-04-05-the-problem-with-metro-is-its-hard-to-differentiate/><span class=button__icon>←</span>
<span class=button__text>The problem with metro is it’s hard to differentiate</span></a></span>
<span class="button next"><a href=https://shayananique.com/posts/2012-03-11-just-downloaded-visual-studio-11-beta-to-give-it-a-try/><span class=button__text>I Just Downloaded Visual Studio 11 Beta To Give It a Try</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://shayananique.com/assets/main.js></script>
<script src=https://shayananique.com/assets/prism.js></script></div></body></html>